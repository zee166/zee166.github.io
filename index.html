<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>อ่านและคัดลอกข้อความจาก .txt</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial; padding: 20px; background:#f6f9f7; color:#0b2b1d; }
    .card { background:white; padding:16px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.06); max-width:800px; margin:auto; }
    pre#txtContent { white-space:pre-wrap; word-wrap:break-word; max-height:300px; overflow:auto; padding:12px; border:1px solid #e3e7e5; border-radius:6px; background:#fcfffb; }
    button { margin-right:8px; padding:8px 12px; border-radius:6px; border:1px solid #9fcfa6; background:#eaf7ed; cursor:pointer; }
    .hint { color:#556b5e; font-size:0.9rem; margin-top:8px; }
    input[type="file"] { margin-top:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>อ่านและคัดลอกข้อความจากไฟล์ .txt</h2>

    <!-- วิธี A: โหลดจากเซิร์ฟเวอร์ (data.txt ต้องอยู่ในที่เดียวกับ index.html และรันผ่าน HTTP) -->
    <section>
      <h3>วิธี A — โหลดจากไฟล์บนเซิร์ฟเวอร์ (data.txt)</h3>
      <button id="btnLoadServer">โหลดไฟล์ data.txt</button>
      <button id="btnCopyServer" disabled>คัดลอกข้อความ (จาก server)</button>
      <div style="margin-top:10px;">
        <pre id="txtContent" aria-live="polite">ยังไม่มีข้อความ — กด "โหลดไฟล์ data.txt" หรือเลือกไฟล์จากเครื่อง (วิธี B).</pre>
      </div>
    </section>

    <hr />

    <!-- วิธี B: ให้ผู้ใช้เลือกไฟล์จากเครื่อง -->
    <section>
      <h3>วิธี B — เลือกไฟล์ .txt จากเครื่องคุณ</h3>
      <input type="file" id="fileInput" accept=".txt,text/plain" />
      <button id="btnCopyLocal" disabled>คัดลอกข้อความ (จากไฟล์ที่เลือก)</button>
      <p class="hint">หากต้องการคัดลอกไฟล์ที่อยู่บนเครื่อง ให้เลือกไฟล์แล้วกดปุ่ม "คัดลอกข้อความ"</p>
    </section>

    <hr />

    <p class="hint">ถ้าคัดลอกสำเร็จจะแสดงข้อความใน console และจะแก้ปุ่มเป็น enabled/disabled ตามสถานะ</p>
  </div>

  <script>
    const btnLoadServer = document.getElementById('btnLoadServer');
    const btnCopyServer = document.getElementById('btnCopyServer');
    const txtContent = document.getElementById('txtContent');

    const fileInput = document.getElementById('fileInput');
    const btnCopyLocal = document.getElementById('btnCopyLocal');

    // ฟังก์ชันคัดลอกแบบปลอดภัยที่ใช้ navigator.clipboard ถ้าพร้อม ถ้าไม่ใช้ fallback
    async function copyToClipboard(text) {
      if (!text) throw new Error('ไม่มีข้อความให้คัดลอก');
      // พยายามใช้ Clipboard API ก่อน
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        return;
      }
      // fallback: สร้าง textarea ชั่วคราว แล้วใช้ execCommand
      const ta = document.createElement('textarea');
      ta.value = text;
      // ป้องกันแสดงใน UI
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      if (!ok) throw new Error('ไม่สามารถคัดลอกด้วย fallback ได้');
    }

    // วิธี A: โหลดไฟล์จาก server (data.txt)
    btnLoadServer.addEventListener('click', async () => {
      btnLoadServer.disabled = true;
      txtContent.textContent = 'กำลังโหลด...';
      btnCopyServer.disabled = true;
      try {
        const resp = await fetch('data.txt', {cache: 'no-store'});
        if (!resp.ok) throw new Error('ไม่พบไฟล์ data.txt (HTTP ' + resp.status + ')');
        const text = await resp.text();
        txtContent.textContent = text || '[ไฟล์ว่าง]';
        btnCopyServer.disabled = false;
        console.log('โหลดไฟล์ data.txt สำเร็จ');
      } catch (err) {
        txtContent.textContent = 'เกิดข้อผิดพลาด: ' + err.message;
        console.error(err);
      } finally {
        btnLoadServer.disabled = false;
      }
    });

    btnCopyServer.addEventListener('click', async () => {
      try {
        await copyToClipboard(txtContent.textContent);
        alert('คัดลอกข้อความสำเร็จ (จาก server) ✅');
      } catch (err) {
        alert('คัดลอกไม่สำเร็จ: ' + err.message);
        console.error(err);
      }
    });

    // วิธี B: อ่านไฟล์ที่ผู้ใช้เลือก (local)
    fileInput.addEventListener('change', (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if (!f) {
        txtContent.textContent = 'ยังไม่มีไฟล์ถูกเลือก';
        btnCopyLocal.disabled = true;
        return;
      }
      if (!f.type.includes('text') && !f.name.endsWith('.txt')) {
        alert('กรุณาเลือกไฟล์ .txt เท่านั้น');
        fileInput.value = '';
        btnCopyLocal.disabled = true;
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        txtContent.textContent = reader.result || '[ไฟล์ว่าง]';
        btnCopyLocal.disabled = false;
      };
      reader.onerror = () => {
        txtContent.textContent = 'ไม่สามารถอ่านไฟล์: ' + reader.error;
        btnCopyLocal.disabled = true;
      };
      reader.readAsText(f, 'UTF-8');
    });

    btnCopyLocal.addEventListener('click', async () => {
      try {
        await copyToClipboard(txtContent.textContent);
        alert('คัดลอกข้อความสำเร็จ (จากไฟล์ที่เลือก) ✅');
      } catch (err) {
        alert('คัดลอกไม่สำเร็จ: ' + err.message);
        console.error(err);
      }
    });

    // ถ้าต้องการ ให้กด Ctrl/Cmd+K ก็จะคัดลอก (ตัวอย่างการเชื่อมคีย์ลัด)
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault();
        // ถ้ามีไฟล์ที่โหลดอยู่แล้ว ให้คัดลอกจาก txtContent
        if (txtContent.textContent && txtContent.textContent.trim().length > 0) {
          copyToClipboard(txtContent.textContent)
            .then(() => alert('คัดลอกข้อความสำเร็จ (คีย์ลัด) ✅'))
            .catch(err => alert('คัดลอกไม่สำเร็จ: ' + err.message));
        } else {
          alert('ยังไม่มีข้อความให้คัดลอก');
        }
      }
    });
  </script>
</body>
</html>
